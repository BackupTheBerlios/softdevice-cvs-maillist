<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Softdevice-cvs] softdevice CHANGELOG,1.154,1.155 SoftOsd.c,1.8,1.9 SoftOsd.h,1.4,1.5 video-dfb.c,1.49,1.50 video-dfb.h,1.16,1.17 video-fb.c,1.12,1.13 video-fb.h,1.6,1.7 video-vidix.c,1.15,1.16 video-vidix.h,1.8,1.9 video-xv.c,1.43,1.44 video-xv.h,1.14,1.15 video.c,1.44,1.45 video.h,1.29,1.30
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/softdevice-cvs/2006q1/index.html" >
   <LINK REL="made" HREF="mailto:softdevice-cvs%40lists.berlios.de?Subject=Re%3A%20%5BSoftdevice-cvs%5D%20softdevice%20CHANGELOG%2C1.154%2C1.155%20SoftOsd.c%2C1.8%2C1.9%20SoftOsd.h%2C1.4%2C1.5%20video-dfb.c%2C1.49%2C1.50%20video-dfb.h%2C1.16%2C1.17%20video-fb.c%2C1.12%2C1.13%20video-fb.h%2C1.6%2C1.7%20video-vidix.c%2C1.15%2C1.16%20video-vidix.h%2C1.8%2C1.9%20video-xv.c%2C1.43%2C1.44%20video-xv.h%2C1.14%2C1.15%20video.c%2C1.44%2C1.45%20video.h%2C1.29%2C1.30&In-Reply-To=%3C200602182220.k1IMKWE04747%40bat.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000294.html">
   <LINK REL="Next"  HREF="000296.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Softdevice-cvs] softdevice CHANGELOG,1.154,1.155 SoftOsd.c,1.8,1.9 SoftOsd.h,1.4,1.5 video-dfb.c,1.49,1.50 video-dfb.h,1.16,1.17 video-fb.c,1.12,1.13 video-fb.h,1.6,1.7 video-vidix.c,1.15,1.16 video-vidix.h,1.8,1.9 video-xv.c,1.43,1.44 video-xv.h,1.14,1.15 video.c,1.44,1.45 video.h,1.29,1.30</H1>
    <B>lucke</B> 
    <A HREF="mailto:softdevice-cvs%40lists.berlios.de?Subject=Re%3A%20%5BSoftdevice-cvs%5D%20softdevice%20CHANGELOG%2C1.154%2C1.155%20SoftOsd.c%2C1.8%2C1.9%20SoftOsd.h%2C1.4%2C1.5%20video-dfb.c%2C1.49%2C1.50%20video-dfb.h%2C1.16%2C1.17%20video-fb.c%2C1.12%2C1.13%20video-fb.h%2C1.6%2C1.7%20video-vidix.c%2C1.15%2C1.16%20video-vidix.h%2C1.8%2C1.9%20video-xv.c%2C1.43%2C1.44%20video-xv.h%2C1.14%2C1.15%20video.c%2C1.44%2C1.45%20video.h%2C1.29%2C1.30&In-Reply-To=%3C200602182220.k1IMKWE04747%40bat.berlios.de%3E"
       TITLE="[Softdevice-cvs] softdevice CHANGELOG,1.154,1.155 SoftOsd.c,1.8,1.9 SoftOsd.h,1.4,1.5 video-dfb.c,1.49,1.50 video-dfb.h,1.16,1.17 video-fb.c,1.12,1.13 video-fb.h,1.6,1.7 video-vidix.c,1.15,1.16 video-vidix.h,1.8,1.9 video-xv.c,1.43,1.44 video-xv.h,1.14,1.15 video.c,1.44,1.45 video.h,1.29,1.30">nobody at sheep.berlios.de
       </A><BR>
    <I>Sat Feb 18 23:20:32 CET 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000294.html">[Softdevice-cvs] softdevice CHANGELOG,1.153,1.154 SoftOsd.c,1.7,1.8 video-vidix.c,1.14,1.15 video-vidix.h,1.7,1.8 video-xv.c,1.42,1.43 video-xv.h,1.13,1.14 video.c,1.43,1.44 video.h,1.28,1.29
</A></li>
        <LI>Next message: <A HREF="000296.html">[Softdevice-cvs] softdevice i18n.c,1.16,1.17
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#295">[ date ]</a>
              <a href="thread.html#295">[ thread ]</a>
              <a href="subject.html#295">[ subject ]</a>
              <a href="author.html#295">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Update of /cvsroot/softdevice/softdevice
In directory sheep:/tmp/cvs-serv8137

Modified Files:
	CHANGELOG SoftOsd.c SoftOsd.h video-dfb.c video-dfb.h 
	video-fb.c video-fb.h video-vidix.c video-vidix.h video-xv.c 
	video-xv.h video.c video.h 
Log Message:
   - fix OSD drawn at wrong location in software OSD blending mode when
     cropping is active


Index: CHANGELOG
===================================================================
RCS file: /cvsroot/softdevice/softdevice/CHANGELOG,v
retrieving revision 1.154
retrieving revision 1.155
diff -C2 -d -r1.154 -r1.155
*** CHANGELOG	17 Feb 2006 21:31:09 -0000	1.154
--- CHANGELOG	18 Feb 2006 22:20:29 -0000	1.155
***************
*** 1,3 ****
--- 1,6 ----
  Changelog
+ 2006-02-18:
+    - fix OSD drawn at wrong location in software OSD blending mode when
+      cropping is active
  2006-02-17:
     - fix bug #6409 (OSD not refreshed fast enough in software OSD blending mode

Index: SoftOsd.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/SoftOsd.c,v
retrieving revision 1.8
retrieving revision 1.9
diff -C2 -d -r1.8 -r1.9
*** SoftOsd.c	17 Feb 2006 21:31:09 -0000	1.8
--- SoftOsd.c	18 Feb 2006 22:20:29 -0000	1.9
***************
*** 41,44 ****
--- 41,45 ----
  
          videoOut = VideoOut;
+         xPan = yPan = 0;
  	videoOut-&gt;OpenOSD();
  	xOfs=X;yOfs=Y;
***************
*** 87,93 ****
                  int newOsdWidth;
                  int newOsdHeight;
  
                  videoOut-&gt;AdjustOSDMode();
!                 videoOut-&gt;GetOSDDimension(newOsdWidth,newOsdHeight);
                  if ( newOsdWidth==-1 || newOsdHeight==-1 )
                  {
--- 88,95 ----
                  int newOsdWidth;
                  int newOsdHeight;
+                 int newXPan, newYPan;
  
                  videoOut-&gt;AdjustOSDMode();
!                 videoOut-&gt;GetOSDDimension(newOsdWidth,newOsdHeight,newXPan,newYPan);
                  if ( newOsdWidth==-1 || newOsdHeight==-1 )
                  {
***************
*** 95,100 ****
                          newOsdHeight=OSD_FULL_HEIGHT;
                  }
!                 
!                 int Depth; bool HasAlpha; bool AlphaInversed; bool IsYUV; 
                  uint8_t *PixelMask;
                  videoOut-&gt;GetOSDMode(Depth,HasAlpha,AlphaInversed,
--- 97,102 ----
                          newOsdHeight=OSD_FULL_HEIGHT;
                  }
! 
!                 int Depth; bool HasAlpha; bool AlphaInversed; bool IsYUV;
                  uint8_t *PixelMask;
                  videoOut-&gt;GetOSDMode(Depth,HasAlpha,AlphaInversed,
***************
*** 103,108 ****
                                  IsYUV,PixelMask);
  
!                 if ( ScreenOsdWidth!=newOsdWidth  || 
!                                 ScreenOsdHeight!=newOsdHeight  || 
                                  modeChanged ) {
                          OSDDEB(&quot;Resolution or mode changed!\n&quot;);
--- 105,116 ----
                                  IsYUV,PixelMask);
  
!                 if (newXPan != xPan || newYPan != yPan) {
!                         xPan = newXPan;
!                         yPan = newYPan;
!                         modeChanged = true;
!                 }
! 
!                 if ( ScreenOsdWidth!=newOsdWidth  ||
!                                 ScreenOsdHeight!=newOsdHeight  ||
                                  modeChanged ) {
                          OSDDEB(&quot;Resolution or mode changed!\n&quot;);
***************
*** 121,128 ****
          int newX;
          int newY;
          bool RefreshAll=false;
  
          videoOut-&gt;AdjustOSDMode();
!         videoOut-&gt;GetOSDDimension(newX,newY);
          if ( newX==-1 || newY==-1 ) {
                  newX=OSD_FULL_WIDTH;
--- 129,137 ----
          int newX;
          int newY;
+         int newXPan, newYPan;
          bool RefreshAll=false;
  
          videoOut-&gt;AdjustOSDMode();
!         videoOut-&gt;GetOSDDimension(newX,newY,newXPan,newYPan);
          if ( newX==-1 || newY==-1 ) {
                  newX=OSD_FULL_WIDTH;
***************
*** 135,142 ****
          };
  
!         int Depth; bool HasAlpha; bool AlphaInversed; bool IsYUV; 
          uint8_t *PixelMask;
          videoOut-&gt;GetOSDMode(Depth,HasAlpha,AlphaInversed,IsYUV,PixelMask);
          bool modeChanged=SetMode(Depth,HasAlpha,AlphaInversed,IsYUV,PixelMask);
          if (modeChanged)
                  videoOut-&gt;ClearOSD();
--- 144,159 ----
          };
  
!         int Depth; bool HasAlpha; bool AlphaInversed; bool IsYUV;
          uint8_t *PixelMask;
          videoOut-&gt;GetOSDMode(Depth,HasAlpha,AlphaInversed,IsYUV,PixelMask);
          bool modeChanged=SetMode(Depth,HasAlpha,AlphaInversed,IsYUV,PixelMask);
+ 
+         if (newXPan != xPan || newYPan != yPan) {
+                 xPan = newXPan;
+                 yPan = newYPan;
+                 RefreshAll = true;
+                 modeChanged = true;
+         }
+ 
          if (modeChanged)
                  videoOut-&gt;ClearOSD();
***************
*** 163,166 ****
--- 180,184 ----
                  videoOut-&gt;CommitUnlockOsdSurface();
          }
+         videoOut-&gt;Osd_changed = true;
  };
  
***************
*** 227,234 ****
  	bool OSD_changed=FlushBitmaps(true);
  	
!         if (OSD_changed) {
                  OsdCommit();
-                 videoOut-&gt;Osd_changed = true;
-         }
  
  	// give priority to the other threads
--- 245,250 ----
  	bool OSD_changed=FlushBitmaps(true);
  	
!         if (OSD_changed)
                  OsdCommit();
  
  	// give priority to the other threads
***************
*** 311,314 ****
--- 327,331 ----
  	OSDDEB(&quot;drawing bitmap %p at P0 (%d,%d) from (%d,%d) to (%d,%d) \n&quot;,
  			bitmap,bitmap-&gt;X0(),bitmap-&gt;Y0(),x1,y1,x2,y2);
+ 
  	y2++;
  	x2++;
***************
*** 666,674 ****
  
                  // convert and copy to video out OSD layer
!                 pY=PY+y*Ystride;
!                 pU=PU+y*UVstride/2;
!                 pV=PV+y*UVstride/2;
!                 pAlphaY=PAlphaY+y*Ystride;
!                 pAlphaUV=PAlphaUV+y*UVstride/2;
                  AYUV_to_AYUV420P(pY,pY+Ystride,pU,pV,
                                  pAlphaY,pAlphaY+Ystride,pAlphaUV,
--- 683,691 ----
  
                  // convert and copy to video out OSD layer
!                 pY=PY+(y+yPan)*Ystride+xPan;
!                 pU=PU+((y+yPan)*UVstride+xPan)/2;
!                 pV=PV+((y+yPan)*UVstride+xPan)/2;
!                 pAlphaY=PAlphaY+(y+yPan)*Ystride+xPan;
!                 pAlphaUV=PAlphaUV+((y+yPan)*UVstride+xPan)/2;
                  AYUV_to_AYUV420P(pY,pY+Ystride,pU,pV,
                                  pAlphaY,pAlphaY+Ystride,pAlphaUV,
***************
*** 764,772 ****
  
                  // convert and copy to video out OSD layer
!                 pY=PY+y*Ystride;
!                 pU=PU+y*UVstride/2;
!                 pV=PV+y*UVstride/2;
!                 pAlphaY=PAlphaY+y*Ystride;
!                 pAlphaUV=PAlphaUV+y*UVstride/2;
                  AYUV_to_AYUV420P(pY,pY+Ystride,pU,pV,
                                pAlphaY,pAlphaY+Ystride,pAlphaUV,
--- 781,789 ----
  
                  // convert and copy to video out OSD layer
!                 pY=PY+(y+yPan)*Ystride+xPan;
!                 pU=PU+((y+yPan)*UVstride+xPan)/2;
!                 pV=PV+((y+yPan)*UVstride+xPan)/2;
!                 pAlphaY=PAlphaY+(y+yPan)*Ystride+xPan;
!                 pAlphaUV=PAlphaUV+((y+yPan)*UVstride+xPan)/2;
                  AYUV_to_AYUV420P(pY,pY+Ystride,pU,pV,
                                pAlphaY,pAlphaY+Ystride,pAlphaUV,
***************
*** 781,788 ****
  //---------------------------RGB modes ----------------------
  
! void cSoftOsd::CopyToBitmap(uint8_t *dest, int linesize, 
                  int dest_Width, int dest_Height, bool RefreshAll,
                  bool *dirtyLines) {
! 	if (dest_Height&gt;=OSD_HEIGHT) 
  		ScaleVUpCopyToBitmap(dest,linesize,dest_Width,dest_Height,
                                  RefreshAll,dirtyLines);
--- 798,805 ----
  //---------------------------RGB modes ----------------------
  
! void cSoftOsd::CopyToBitmap(uint8_t *dest, int linesize,
                  int dest_Width, int dest_Height, bool RefreshAll,
                  bool *dirtyLines) {
! 	if (dest_Height&gt;=OSD_HEIGHT)
  		ScaleVUpCopyToBitmap(dest,linesize,dest_Width,dest_Height,
                                  RefreshAll,dirtyLines);

Index: SoftOsd.h
===================================================================
RCS file: /cvsroot/softdevice/softdevice/SoftOsd.h,v
retrieving revision 1.4
retrieving revision 1.5
diff -C2 -d -r1.4 -r1.5
*** SoftOsd.h	4 Feb 2006 10:05:09 -0000	1.4
--- SoftOsd.h	18 Feb 2006 22:20:29 -0000	1.5
***************
*** 56,60 ****
      cVideoOut *videoOut;
  protected:
!     int xOfs,yOfs;
      uint32_t *OSD_Bitmap;
      bool dirty_lines[OSD_HEIGHT+10];
--- 56,61 ----
      cVideoOut *videoOut;
  protected:
!     int      xOfs, yOfs;
!     int      xPan, yPan;
      uint32_t *OSD_Bitmap;
      bool dirty_lines[OSD_HEIGHT+10];

Index: video-dfb.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video-dfb.c,v
retrieving revision 1.49
retrieving revision 1.50
diff -C2 -d -r1.49 -r1.50
*** video-dfb.c	10 Feb 2006 17:33:49 -0000	1.49
--- video-dfb.c	18 Feb 2006 22:20:29 -0000	1.50
***************
*** 1119,1126 ****
  /* ---------------------------------------------------------------------------
   */
! void cDFBVideoOut::GetOSDDimension( int &amp;Width, int &amp;Height)
  {
    Width=Xres;
    Height=Yres;
  }
  
--- 1119,1127 ----
  /* ---------------------------------------------------------------------------
   */
! void cDFBVideoOut::GetOSDDimension( int &amp;Width, int &amp;Height, int &amp;xPan, int &amp;yPan)
  {
    Width=Xres;
    Height=Yres;
+   xPan = yPan = 0;
  }
  

Index: video-dfb.h
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video-dfb.h,v
retrieving revision 1.16
retrieving revision 1.17
diff -C2 -d -r1.16 -r1.17
*** video-dfb.h	10 Feb 2006 17:33:49 -0000	1.16
--- video-dfb.h	18 Feb 2006 22:20:29 -0000	1.17
***************
*** 61,65 ****
      virtual void GetOSDMode(int &amp;Depth, bool &amp;HasAlpha, bool &amp;AlphaInversed,
                              bool &amp;IsYUV, uint8_t *&amp;PixelMask);
!     virtual void GetOSDDimension( int &amp;Width, int &amp;Height);
      virtual void OSDStart();
      virtual void GetLockOsdSurface(uint8_t *&amp;osd, int &amp;stride,
--- 61,66 ----
      virtual void GetOSDMode(int &amp;Depth, bool &amp;HasAlpha, bool &amp;AlphaInversed,
                              bool &amp;IsYUV, uint8_t *&amp;PixelMask);
!     virtual void GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight,
!                                  int &amp;xPan, int &amp;yPan);
      virtual void OSDStart();
      virtual void GetLockOsdSurface(uint8_t *&amp;osd, int &amp;stride,

Index: video-fb.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video-fb.c,v
retrieving revision 1.12
retrieving revision 1.13
diff -C2 -d -r1.12 -r1.13
*** video-fb.c	3 Feb 2006 22:34:54 -0000	1.12
--- video-fb.c	18 Feb 2006 22:20:29 -0000	1.13
***************
*** 172,180 ****
  /* ---------------------------------------------------------------------------
   */
! void cFBVideoOut::GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight) {
     switch (current_osdMode) {
        case OSDMODE_PSEUDO :
                  OsdWidth=Xres;
                  OsdHeight=Yres;
               break;
      }
--- 172,182 ----
  /* ---------------------------------------------------------------------------
   */
! void cFBVideoOut::GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight,
!                                   int &amp;xPan, int &amp;yPan) {
     switch (current_osdMode) {
        case OSDMODE_PSEUDO :
                  OsdWidth=Xres;
                  OsdHeight=Yres;
+                 xPan = yPan = 0;
               break;
      }

Index: video-fb.h
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video-fb.h,v
retrieving revision 1.6
retrieving revision 1.7
diff -C2 -d -r1.6 -r1.7
*** video-fb.h	3 Feb 2006 22:34:54 -0000	1.6
--- video-fb.h	18 Feb 2006 22:20:29 -0000	1.7
***************
*** 38,42 ****
                    bool *&amp;dirtyLines);
    virtual void CommitUnlockOsdSurface();
!   virtual void GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight);
  #else
    virtual void Refresh();
--- 38,43 ----
                    bool *&amp;dirtyLines);
    virtual void CommitUnlockOsdSurface();
!   virtual void GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight,
!                                int &amp;xPan, int &amp;yPan);
  #else
    virtual void Refresh();

Index: video-vidix.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video-vidix.c,v
retrieving revision 1.15
retrieving revision 1.16
diff -C2 -d -r1.15 -r1.16
*** video-vidix.c	17 Feb 2006 21:31:09 -0000	1.15
--- video-vidix.c	18 Feb 2006 22:20:29 -0000	1.16
***************
*** 575,587 ****
  /* ---------------------------------------------------------------------------
   */
! void cVidixVideoOut::GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight) {
     switch (current_osdMode) {
        case OSDMODE_PSEUDO :
                  OsdWidth=Xres;//*9/10;
                  OsdHeight=Yres;//*9/10;
               break;
        case OSDMODE_SOFTWARE:
                  OsdWidth=swidth;//*9/10;
                  OsdHeight=sheight;//*9/10;
               break;
      };
--- 575,591 ----
  /* ---------------------------------------------------------------------------
   */
! void cVidixVideoOut::GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight,
!                                      int &amp;xPan, int &amp;yPan) {
     switch (current_osdMode) {
        case OSDMODE_PSEUDO :
                  OsdWidth=Xres;//*9/10;
                  OsdHeight=Yres;//*9/10;
+                 xPan = yPan = 0;
               break;
        case OSDMODE_SOFTWARE:
                  OsdWidth=swidth;//*9/10;
                  OsdHeight=sheight;//*9/10;
+                 xPan = sxoff;
+                 yPan = syoff;
               break;
      };

Index: video-vidix.h
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video-vidix.h,v
retrieving revision 1.8
retrieving revision 1.9
diff -C2 -d -r1.8 -r1.9
*** video-vidix.h	17 Feb 2006 21:31:10 -0000	1.8
--- video-vidix.h	18 Feb 2006 22:20:30 -0000	1.9
***************
*** 1,71 ****
! /*
!  * video-vidix.h: A plugin for the Video Disk Recorder
!  *
!  * See the README file for copyright information and how to reach the author.
!  *
!  * $Id$
!  */
! 
! #ifndef VIDEO_VIDIX_H
! #define VIDEO_VIDIX_H
! 
! #include &quot;video.h&quot;
! #include &lt;linux/fb.h&gt;
! #include &quot;vidixlib.h&quot;
! #include &quot;fourcc.h&quot;
! 
! 
! class cVidixVideoOut : public cVideoOut {
! private:
!     uint8_t * fb;
! 
!     int fbdev;
!     int fb_line_len;
! 
!     struct fb_fix_screeninfo fb_finfo;
!     struct fb_var_screeninfo fb_vinfo;
! 
!     int orig_cmaplen;
!     __u16 * orig_cmap;
! 
!     char               * vidix_name;
!     int                vidix_version;
!     VDL_HANDLE         vidix_handler;
!     vidix_capability_t vidix_cap;
!     vidix_playback_t   vidix_play;
!     vidix_fourcc_t     vidix_fourcc;
!     vidix_yuv_t        dstrides;
!     vidix_grkey_t      gr_key;
!     uint8_t            next_frame;
! 
!     void SetParams(int Ystride, int UVstride);
! 
! public:
!   cVidixVideoOut(cSetupStore *setupStore);
!   virtual ~cVidixVideoOut();
! 
! #if VDRVERSNUM &gt;= 10307
!   virtual void ClearOSD();
!   virtual void AdjustOSDMode();  
!   virtual void GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight); 
!   virtual void GetOSDMode(int &amp;Depth,bool &amp;HasAlpha, bool &amp;AlphaInversed,
! 		  bool &amp;IsYUV,uint8_t *&amp;PixelMask)
!   { Depth=Bpp; HasAlpha=false;AlphaInversed=false; 
! 	  IsYUV=(current_osdMode == OSDMODE_SOFTWARE);
! 	  PixelMask=NULL;};
!   virtual void GetLockOsdSurface(uint8_t *&amp;osd, int &amp;stride, 
!                   bool *&amp;dirtyLines);
! #else
!   virtual void Refresh();
! #endif
! 
!   virtual void CloseOSD();
! //  virtual void OpenOSD();  
!   virtual void YUV(uint8_t *Py, uint8_t *Pu, uint8_t *Pv, int Width, int Height, int Ystride, int UVstride);
!   virtual void Pause(void);
! 
!   bool MatchPixelFormat(void);
!   void AllocLayer(void);
! };
! 
! #endif // VIDEO_VIDIX_H
--- 1,72 ----
! /*
!  * video-vidix.h: A plugin for the Video Disk Recorder
!  *
!  * See the README file for copyright information and how to reach the author.
!  *
!  * $Id$
!  */
! 
! #ifndef VIDEO_VIDIX_H
! #define VIDEO_VIDIX_H
! 
! #include &quot;video.h&quot;
! #include &lt;linux/fb.h&gt;
! #include &quot;vidixlib.h&quot;
! #include &quot;fourcc.h&quot;
! 
! 
! class cVidixVideoOut : public cVideoOut {
! private:
!     uint8_t * fb;
! 
!     int fbdev;
!     int fb_line_len;
! 
!     struct fb_fix_screeninfo fb_finfo;
!     struct fb_var_screeninfo fb_vinfo;
! 
!     int orig_cmaplen;
!     __u16 * orig_cmap;
! 
!     char               * vidix_name;
!     int                vidix_version;
!     VDL_HANDLE         vidix_handler;
!     vidix_capability_t vidix_cap;
!     vidix_playback_t   vidix_play;
!     vidix_fourcc_t     vidix_fourcc;
!     vidix_yuv_t        dstrides;
!     vidix_grkey_t      gr_key;
!     uint8_t            next_frame;
! 
!     void SetParams(int Ystride, int UVstride);
! 
! public:
!   cVidixVideoOut(cSetupStore *setupStore);
!   virtual ~cVidixVideoOut();
! 
! #if VDRVERSNUM &gt;= 10307
!   virtual void ClearOSD();
!   virtual void AdjustOSDMode();  
!   virtual void GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight,
!                                int &amp;xPan, int &amp;yPan);
!   virtual void GetOSDMode(int &amp;Depth,bool &amp;HasAlpha, bool &amp;AlphaInversed,
! 		  bool &amp;IsYUV,uint8_t *&amp;PixelMask)
!   { Depth=Bpp; HasAlpha=false;AlphaInversed=false; 
! 	  IsYUV=(current_osdMode == OSDMODE_SOFTWARE);
! 	  PixelMask=NULL;};
!   virtual void GetLockOsdSurface(uint8_t *&amp;osd, int &amp;stride, 
!                   bool *&amp;dirtyLines);
! #else
!   virtual void Refresh();
! #endif
! 
!   virtual void CloseOSD();
! //  virtual void OpenOSD();  
!   virtual void YUV(uint8_t *Py, uint8_t *Pu, uint8_t *Pv, int Width, int Height, int Ystride, int UVstride);
!   virtual void Pause(void);
! 
!   bool MatchPixelFormat(void);
!   void AllocLayer(void);
! };
! 
! #endif // VIDEO_VIDIX_H

Index: video-xv.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video-xv.c,v
retrieving revision 1.43
retrieving revision 1.44
diff -C2 -d -r1.43 -r1.44
*** video-xv.c	17 Feb 2006 21:31:10 -0000	1.43
--- video-xv.c	18 Feb 2006 22:20:30 -0000	1.44
***************
*** 1218,1230 ****
  /* ---------------------------------------------------------------------------
   */
! void cXvVideoOut::GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight) {
     switch (current_osdMode) {
        case OSDMODE_PSEUDO :
                  OsdWidth=lwidth&lt;osd_max_width?lwidth:osd_max_width;
                  OsdHeight=lheight&lt;osd_max_height?lheight:osd_max_height;
               break;
        case OSDMODE_SOFTWARE:
                  OsdWidth=swidth;//*9/10;
                  OsdHeight=sheight;//*9/10;
               break;
      };
--- 1218,1234 ----
  /* ---------------------------------------------------------------------------
   */
! void cXvVideoOut::GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight,
!                                   int &amp;xPan, int &amp;yPan) {
     switch (current_osdMode) {
        case OSDMODE_PSEUDO :
                  OsdWidth=lwidth&lt;osd_max_width?lwidth:osd_max_width;
                  OsdHeight=lheight&lt;osd_max_height?lheight:osd_max_height;
+                 xPan = yPan = 0;
               break;
        case OSDMODE_SOFTWARE:
                  OsdWidth=swidth;//*9/10;
                  OsdHeight=sheight;//*9/10;
+                 xPan = sxoff;
+                 yPan = syoff;
               break;
      };

Index: video-xv.h
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video-xv.h,v
retrieving revision 1.14
retrieving revision 1.15
diff -C2 -d -r1.14 -r1.15
*** video-xv.h	17 Feb 2006 21:31:10 -0000	1.14
--- video-xv.h	18 Feb 2006 22:20:30 -0000	1.15
***************
*** 151,156 ****
    virtual void ClearOSD();
    virtual void AdjustOSDMode();
!   virtual void GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight);
!   virtual void GetOSDMode(int &amp;Depth, bool &amp;HasAlpha, bool &amp;AlphaInversed, 
                    bool &amp;IsYUV, uint8_t *&amp;PixelMask);
    virtual void GetLockOsdSurface(uint8_t *&amp;osd, int &amp;stride,
--- 151,157 ----
    virtual void ClearOSD();
    virtual void AdjustOSDMode();
!   virtual void GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight,
!                                int &amp;xPan, int &amp;yPan);
!   virtual void GetOSDMode(int &amp;Depth, bool &amp;HasAlpha, bool &amp;AlphaInversed,
                    bool &amp;IsYUV, uint8_t *&amp;PixelMask);
    virtual void GetLockOsdSurface(uint8_t *&amp;osd, int &amp;stride,

Index: video.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video.c,v
retrieving revision 1.44
retrieving revision 1.45
diff -C2 -d -r1.44 -r1.45
*** video.c	17 Feb 2006 21:31:10 -0000	1.44
--- video.c	18 Feb 2006 22:20:30 -0000	1.45
***************
*** 416,419 ****
--- 416,420 ----
    areaMutex. Lock();
    OsdRefreshCounter=0;
+   RecalculateAspect();
    CheckArea(w, h);
    // display picture

Index: video.h
===================================================================
RCS file: /cvsroot/softdevice/softdevice/video.h,v
retrieving revision 1.29
retrieving revision 1.30
diff -C2 -d -r1.29 -r1.30
*** video.h	17 Feb 2006 21:31:10 -0000	1.29
--- video.h	18 Feb 2006 22:20:30 -0000	1.30
***************
*** 179,187 ****
      virtual void AdjustOSDMode();
  
!     virtual void GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight)
      // called whenever OSD is to be displayed
      // every video-out should implement a method which desired osd dimension
      // for scaling, if -1,-1 is returned no scaling is done.
!     { OsdWidth=-1;OsdHeight=-1;};
       
      virtual void GetOSDMode(int &amp;Depth, bool &amp;HasAlpha, bool &amp;AlphaInversed, 
--- 179,188 ----
      virtual void AdjustOSDMode();
  
!     virtual void GetOSDDimension(int &amp;OsdWidth,int &amp;OsdHeight,
!                                  int &amp;xPan, int &amp;yPan)
      // called whenever OSD is to be displayed
      // every video-out should implement a method which desired osd dimension
      // for scaling, if -1,-1 is returned no scaling is done.
!     { OsdWidth=-1;OsdHeight=-1; xPan = yPan = 0;};
       
      virtual void GetOSDMode(int &amp;Depth, bool &amp;HasAlpha, bool &amp;AlphaInversed, 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000294.html">[Softdevice-cvs] softdevice CHANGELOG,1.153,1.154 SoftOsd.c,1.7,1.8 video-vidix.c,1.14,1.15 video-vidix.h,1.7,1.8 video-xv.c,1.42,1.43 video-xv.h,1.13,1.14 video.c,1.43,1.44 video.h,1.28,1.29
</A></li>
	<LI>Next message: <A HREF="000296.html">[Softdevice-cvs] softdevice i18n.c,1.16,1.17
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#295">[ date ]</a>
              <a href="thread.html#295">[ thread ]</a>
              <a href="subject.html#295">[ subject ]</a>
              <a href="author.html#295">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/softdevice-cvs">More information about the Softdevice-cvs
mailing list</a><br>
</body></html>
