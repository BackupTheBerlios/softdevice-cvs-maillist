<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Softdevice-cvs] softdevice audio-ac3pt.c,1.2,1.3
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/softdevice-cvs/2007q4/index.html" >
   <LINK REL="made" HREF="mailto:softdevice-cvs%40lists.berlios.de?Subject=Re%3A%20%5BSoftdevice-cvs%5D%20softdevice%20audio-ac3pt.c%2C1.2%2C1.3&In-Reply-To=%3C20071225132258.88381123D7A%40mail.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000588.html">
   <LINK REL="Next"  HREF="000590.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Softdevice-cvs] softdevice audio-ac3pt.c,1.2,1.3</H1>
    <B>lucke</B> 
    <A HREF="mailto:softdevice-cvs%40lists.berlios.de?Subject=Re%3A%20%5BSoftdevice-cvs%5D%20softdevice%20audio-ac3pt.c%2C1.2%2C1.3&In-Reply-To=%3C20071225132258.88381123D7A%40mail.berlios.de%3E"
       TITLE="[Softdevice-cvs] softdevice audio-ac3pt.c,1.2,1.3">nobody at sheep.berlios.de
       </A><BR>
    <I>Tue Dec 25 14:22:58 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000588.html">[Softdevice-cvs] softdevice VideoFilter.c,1.8,1.9
</A></li>
        <LI>Next message: <A HREF="000590.html">[Softdevice-cvs] softdevice audio-alsa.c,1.7,1.8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#589">[ date ]</a>
              <a href="thread.html#589">[ thread ]</a>
              <a href="subject.html#589">[ subject ]</a>
              <a href="author.html#589">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Update of /cvsroot/softdevice/softdevice
In directory sheep:/tmp/cvs-serv11296

Modified Files:
	audio-ac3pt.c 
Log Message:
\n\r -&gt; \n cleanup, spelling

Index: audio-ac3pt.c
===================================================================
RCS file: /cvsroot/softdevice/softdevice/audio-ac3pt.c,v
retrieving revision 1.2
retrieving revision 1.3
diff -C2 -d -r1.2 -r1.3
*** audio-ac3pt.c	15 Jan 2006 20:41:15 -0000	1.2
--- audio-ac3pt.c	25 Dec 2007 13:21:46 -0000	1.3
***************
*** 203,207 ****
      syncword = 0xffff;
      sbuffer_size = 0;
!     fprintf(stderr, &quot;ac3play: ** Invalid frame found - try to syncing **\n\r&quot;);
      if (ac3-&gt;out &gt;= ac3-&gt;tail)
        goto done;
--- 203,207 ----
      syncword = 0xffff;
      sbuffer_size = 0;
!     fprintf(stderr, &quot;ac3play: ** Invalid frame found - try to syncing **\n&quot;);
      if (ac3-&gt;out &gt;= ac3-&gt;tail)
        goto done;
***************
*** 218,224 ****
      fprintf(stderr,
              &quot;ac3play: Warning: sample rate of&quot;
!             &quot; the current AC-3 stream (%d) does not\n\r&quot;,
              syncinfo-&gt;sampling_rate);
!     fprintf(stderr, &quot;	 fit the configured PCM rate (%d)!\n\r&quot;, rate);
    }
  
--- 218,224 ----
      fprintf(stderr,
              &quot;ac3play: Warning: sample rate of&quot;
!             &quot; the current AC-3 stream (%d) does not\n&quot;,
              syncinfo-&gt;sampling_rate);
!     fprintf(stderr, &quot;	 fit the configured PCM rate (%d)!\n&quot;, rate);
    }
  
***************
*** 237,241 ****
      syncword = 0xffff;
      sbuffer_size = 0;
!     fprintf(stderr, &quot;ac3play: ** CRC failed - try to syncing **\n\r&quot;);
      if (ac3-&gt;out &gt;= ac3-&gt;tail)
        goto done;
--- 237,241 ----
      syncword = 0xffff;
      sbuffer_size = 0;
!     fprintf(stderr, &quot;ac3play: ** CRC failed - try to syncing **\n&quot;);
      if (ac3-&gt;out &gt;= ac3-&gt;tail)
        goto done;
***************
*** 283,287 ****
  
    if ((res = snd_pcm_status(handle, ac3Status))&lt;0) {
!     fprintf(stderr, &quot;ac3play: ac3Status error: %s\n\r&quot;, snd_strerror(res));
      return;
    }
--- 283,287 ----
  
    if ((res = snd_pcm_status(handle, ac3Status))&lt;0) {
!     fprintf(stderr, &quot;ac3play: ac3Status error: %s\n&quot;, snd_strerror(res));
      return;
    }
***************
*** 291,298 ****
      snd_pcm_status_get_trigger_tstamp(ac3Status, &amp;tstamp);
      timersub(&amp;now, &amp;tstamp, &amp;diff);
!     fprintf(stderr, &quot;ac3play: xunderrun!!! (at least %.3f ms long)\n\r&quot;,
              diff.tv_sec * 1000 + diff.tv_usec / 1000.0);
      if ((res = snd_pcm_prepare(handle))&lt;0) {
!       fprintf(stderr, &quot;ac3play: xunderrun: prepare error: %s\n\r&quot;,
                snd_strerror(res));
        return;
--- 291,298 ----
      snd_pcm_status_get_trigger_tstamp(ac3Status, &amp;tstamp);
      timersub(&amp;now, &amp;tstamp, &amp;diff);
!     fprintf(stderr, &quot;ac3play: xunderrun!!! (at least %.3f ms long)\n&quot;,
              diff.tv_sec * 1000 + diff.tv_usec / 1000.0);
      if ((res = snd_pcm_prepare(handle))&lt;0) {
!       fprintf(stderr, &quot;ac3play: xunderrun: prepare error: %s\n&quot;,
                snd_strerror(res));
        return;
***************
*** 310,322 ****
  
    if ((res = snd_pcm_status(handle, ac3Status))&lt;0) {
!     fprintf(stderr, &quot;ac3play: ac3Status error: %s\n\r&quot;, snd_strerror(res));
      return;
    }
    if (snd_pcm_status_get_state(ac3Status) == SND_PCM_STATE_SUSPENDED) {
!     fprintf(stderr, &quot;ac3play: xsuspend!!! trying to resume\n\r&quot;);
      while ((res = snd_pcm_resume(handle)) == -EAGAIN)
        usleep(100000);
      if ((res = snd_pcm_prepare(handle))&lt;0) {
!       fprintf(stderr, &quot;ac3play: xsuspend: prepare error: %s\n\r&quot;,
                        snd_strerror(res));
        return;
--- 310,322 ----
  
    if ((res = snd_pcm_status(handle, ac3Status))&lt;0) {
!     fprintf(stderr, &quot;ac3play: ac3Status error: %s\n&quot;, snd_strerror(res));
      return;
    }
    if (snd_pcm_status_get_state(ac3Status) == SND_PCM_STATE_SUSPENDED) {
!     fprintf(stderr, &quot;ac3play: xsuspend!!! trying to resume\n&quot;);
      while ((res = snd_pcm_resume(handle)) == -EAGAIN)
        usleep(100000);
      if ((res = snd_pcm_prepare(handle))&lt;0) {
!       fprintf(stderr, &quot;ac3play: xsuspend: prepare error: %s\n&quot;,
                        snd_strerror(res));
        return;
***************
*** 395,399 ****
            continue;
          default:
!           fprintf(stderr, &quot;ac3play: snd_pcm_writei returned error: %s\n\r&quot;,
                    snd_strerror(r));
            exit(1);
--- 395,399 ----
            continue;
          default:
!           fprintf(stderr, &quot;ac3play: snd_pcm_writei returned error: %s\n&quot;,
                    snd_strerror(r));
            exit(1);
***************
*** 512,516 ****
    if ((err = snd_pcm_open(handle, device, SND_PCM_STREAM_PLAYBACK, 0)) &lt; 0)
    {
!     fprintf(stderr, &quot;ac3play: sound open: %s\n\r&quot;, snd_strerror(err));
      return 1;
    }
--- 512,516 ----
    if ((err = snd_pcm_open(handle, device, SND_PCM_STREAM_PLAYBACK, 0)) &lt; 0)
    {
!     fprintf(stderr, &quot;ac3play: sound open: %s\n&quot;, snd_strerror(err));
      return 1;
    }
***************
*** 522,526 ****
  
    if ((err = snd_pcm_info(*handle, info)) &lt; 0) {
!     fprintf(stderr, &quot;ac3play: sound info: %s\n\r&quot;, snd_strerror(err));
      snd_pcm_close(*handle);
      return 1;
--- 522,526 ----
  
    if ((err = snd_pcm_info(*handle, info)) &lt; 0) {
!     fprintf(stderr, &quot;ac3play: sound info: %s\n&quot;, snd_strerror(err));
      snd_pcm_close(*handle);
      return 1;
***************
*** 560,573 ****
      ctl_card = snd_pcm_info_get_card(info);
      if (ctl_card &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Unable to setup the IEC958 (S/PDIF) interface - PCM has no assigned card\n\r&quot;);
        goto __diga_end;
      }
      sprintf(ctl_name, &quot;hw:%d&quot;, ctl_card);
      if ((err = snd_ctl_open(&amp;ctl_handle, ctl_name, 0)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Unable to open the control interface '%s': %s\n\r&quot;, ctl_name, snd_strerror(err));
        goto __diga_end;
      }
      if ((err = snd_ctl_elem_write(ctl_handle, ctl)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Unable to update the IEC958 control: %s\n\r&quot;, snd_strerror(err));
        goto __diga_end;
      }
--- 560,573 ----
      ctl_card = snd_pcm_info_get_card(info);
      if (ctl_card &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Unable to setup the IEC958 (S/PDIF) interface - PCM has no assigned card\n&quot;);
        goto __diga_end;
      }
      sprintf(ctl_name, &quot;hw:%d&quot;, ctl_card);
      if ((err = snd_ctl_open(&amp;ctl_handle, ctl_name, 0)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Unable to open the control interface '%s': %s\n&quot;, ctl_name, snd_strerror(err));
        goto __diga_end;
      }
      if ((err = snd_ctl_elem_write(ctl_handle, ctl)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Unable to update the IEC958 control: %s\n&quot;, snd_strerror(err));
        goto __diga_end;
      }
***************
*** 591,608 ****
  
      if ((err = snd_pcm_hw_params_any(*handle, params)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Broken configuration for this PCM: no configurations available\n\r&quot;);
        return 2;
      }
      if ((err = snd_pcm_hw_params_set_access(*handle, params, access)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Access type not available\n\r&quot;);
        return 2;
      }
      if ((err = snd_pcm_hw_params_set_format(*handle, params, format)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Sample format non available\n\r&quot;);
        return 2;
      }
  
      if ((err = snd_pcm_hw_params_set_channels(*handle, params, channels)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Channels count non avaible\n\r&quot;);
        return 2;
      }
--- 591,608 ----
  
      if ((err = snd_pcm_hw_params_any(*handle, params)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Broken configuration for this PCM: no configurations available\n&quot;);
        return 2;
      }
      if ((err = snd_pcm_hw_params_set_access(*handle, params, access)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Access type not available\n&quot;);
        return 2;
      }
      if ((err = snd_pcm_hw_params_set_format(*handle, params, format)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Sample format non available\n&quot;);
        return 2;
      }
  
      if ((err = snd_pcm_hw_params_set_channels(*handle, params, channels)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Channels count non available\n&quot;);
        return 2;
      }
***************
*** 614,618 ****
      // function returns less than 0 on error or greater than 0
      if ((err = snd_pcm_hw_params_set_period_size(*handle, params, PERIODSIZE, 0)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Period size not available: %s\n\r&quot;, snd_strerror(err));
        periodSize = 0;
        return 2;
--- 614,618 ----
      // function returns less than 0 on error or greater than 0
      if ((err = snd_pcm_hw_params_set_period_size(*handle, params, PERIODSIZE, 0)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Period size not available: %s\n&quot;, snd_strerror(err));
        periodSize = 0;
        return 2;
***************
*** 620,624 ****
      // function returns less than 0 on error or greater than 0
      if ((err = snd_pcm_hw_params_set_periods(*handle, params, frames, 0)) &lt; 0) {
!     fprintf(stderr, &quot;ac3play: Period count not available: %s\n\r&quot;, snd_strerror(err));
      return 2;
      }
--- 620,624 ----
      // function returns less than 0 on error or greater than 0
      if ((err = snd_pcm_hw_params_set_periods(*handle, params, frames, 0)) &lt; 0) {
!     fprintf(stderr, &quot;ac3play: Period count not available: %s\n&quot;, snd_strerror(err));
      return 2;
      }
***************
*** 626,634 ****
      // function returns less than 0 on error or greater than 0
      if ((err = snd_pcm_hw_params_get_period_size(params, &amp;periodSize, 0)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Buffer size not set: %s\n\r&quot;, snd_strerror(err));
        return 2;
      }
      if (PERIODSIZE != periodSize) {
!       fprintf(stderr, &quot;ac3play: Period size not set: %s\n\r&quot;, snd_strerror(err));
        return 2;
      }
--- 626,634 ----
      // function returns less than 0 on error or greater than 0
      if ((err = snd_pcm_hw_params_get_period_size(params, &amp;periodSize, 0)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Buffer size not set: %s\n&quot;, snd_strerror(err));
        return 2;
      }
      if (PERIODSIZE != periodSize) {
!       fprintf(stderr, &quot;ac3play: Period size not set: %s\n&quot;, snd_strerror(err));
        return 2;
      }
***************
*** 637,645 ****
      // function returns less than 0 on error or greater than 0
      if ((err = snd_pcm_hw_params_get_buffer_size(params, &amp;bufferSize)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Buffer size not set: %s\n\r&quot;, snd_strerror(err));
        return 2;
      }
      if (periodSize * frames != bufferSize) {
!       fprintf(stderr, &quot;ac3play: Buffer size not set: %s\n\r&quot;, snd_strerror(err));
        return 2;
      }
--- 637,645 ----
      // function returns less than 0 on error or greater than 0
      if ((err = snd_pcm_hw_params_get_buffer_size(params, &amp;bufferSize)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Buffer size not set: %s\n&quot;, snd_strerror(err));
        return 2;
      }
      if (periodSize * frames != bufferSize) {
!       fprintf(stderr, &quot;ac3play: Buffer size not set: %s\n&quot;, snd_strerror(err));
        return 2;
      }
***************
*** 649,653 ****
  
      if ((err = snd_pcm_hw_params(*handle, params)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Cannot set buffer size\n\r&quot;);
  //      snd_pcm_hw_params_dump(params, log);
        return 2;
--- 649,653 ----
  
      if ((err = snd_pcm_hw_params(*handle, params)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Cannot set buffer size\n&quot;);
  //      snd_pcm_hw_params_dump(params, log);
        return 2;
***************
*** 655,659 ****
  
      if ((err = snd_pcm_sw_params_current(*handle, swparams)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Cannot get soft parameters: %s\n\r&quot;, snd_strerror(err));
        return 2;
      }
--- 655,659 ----
  
      if ((err = snd_pcm_sw_params_current(*handle, swparams)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Cannot get soft parameters: %s\n&quot;, snd_strerror(err));
        return 2;
      }
***************
*** 662,679 ****
  #if 0
      if ((err = snd_pcm_sw_params_set_sleep_min(*handle, swparams, 0)) &lt; 0)
!       fprintf(stderr, &quot;ac3play: Minimal sleep time not available: %s\n\r&quot;, snd_strerror(err));
  #endif
  
      if ((err = snd_pcm_sw_params_set_avail_min(*handle, swparams, SAMPLE_BUF)) &lt; 0)
!       fprintf(stderr, &quot;ac3play: Minimal period size not available: %s\n\r&quot;, snd_strerror(err));
  
      if ((err =  snd_pcm_sw_params_set_xfer_align(*handle, swparams, SAMPLE_BUF/6)) &lt; 0)
!       fprintf(stderr, &quot;ac3play: Aligned period size not available: %s\n\r&quot;, snd_strerror(err));
  
      if ((err = snd_pcm_sw_params_set_start_threshold(*handle, swparams, 2*SAMPLE_BUF)) &lt; 0)
!       fprintf(stderr, &quot;ac3play: Start threshold not available: %s\n\r&quot;, snd_strerror(err));
  
      if ((err = snd_pcm_sw_params(*handle, swparams)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Cannot set soft parameters: %s\n\r&quot;, snd_strerror(err));
  //      snd_pcm_sw_params_dump(swparams, log);
        return 2;
--- 662,679 ----
  #if 0
      if ((err = snd_pcm_sw_params_set_sleep_min(*handle, swparams, 0)) &lt; 0)
!       fprintf(stderr, &quot;ac3play: Minimal sleep time not available: %s\n&quot;, snd_strerror(err));
  #endif
  
      if ((err = snd_pcm_sw_params_set_avail_min(*handle, swparams, SAMPLE_BUF)) &lt; 0)
!       fprintf(stderr, &quot;ac3play: Minimal period size not available: %s\n&quot;, snd_strerror(err));
  
      if ((err =  snd_pcm_sw_params_set_xfer_align(*handle, swparams, SAMPLE_BUF/6)) &lt; 0)
!       fprintf(stderr, &quot;ac3play: Aligned period size not available: %s\n&quot;, snd_strerror(err));
  
      if ((err = snd_pcm_sw_params_set_start_threshold(*handle, swparams, 2*SAMPLE_BUF)) &lt; 0)
!       fprintf(stderr, &quot;ac3play: Start threshold not available: %s\n&quot;, snd_strerror(err));
  
      if ((err = snd_pcm_sw_params(*handle, swparams)) &lt; 0) {
!       fprintf(stderr, &quot;ac3play: Cannot set soft parameters: %s\n&quot;, snd_strerror(err));
  //      snd_pcm_sw_params_dump(swparams, log);
        return 2;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000588.html">[Softdevice-cvs] softdevice VideoFilter.c,1.8,1.9
</A></li>
	<LI>Next message: <A HREF="000590.html">[Softdevice-cvs] softdevice audio-alsa.c,1.7,1.8
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#589">[ date ]</a>
              <a href="thread.html#589">[ thread ]</a>
              <a href="subject.html#589">[ subject ]</a>
              <a href="author.html#589">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/softdevice-cvs">More information about the Softdevice-cvs
mailing list</a><br>
</body></html>
